// Bookmarklet: Clean & Download â€” HTML Snapshot Tool
// Usage: Create a new bookmark, paste the single-line `javascript:(...)` content below as the URL.

javascript:(()=>{const $all=(s,r=document)=>[...r.querySelectorAll(s)],rmAll=s=>$all(s).forEach(n=>n.remove());$all('script').forEach(s=>{const t=(s.getAttribute('type')||'').toLowerCase().trim();if(t!=='application/ld+json')s.remove();});rmAll('link[rel="stylesheet"],style,iframe,video,audio,embed,object,canvas,form,input,button,textarea,select,noscript');rmAll('link[rel="preload"],link[rel="preconnect"],link[rel="modulepreload"]');const keepGlobal=new Set(['href','src','alt','title','lang']);const keepMicro=new Set(['itemscope','itemtype','itemprop','itemid']);const keepHeadMeta=new Set(['name','property','content','charset','http-equiv']);const keepLinkHead=new Set(['rel','href','hreflang','type','sizes']);const keepHtml=new Set(['lang','dir','prefix']);const inHead=e=>e.closest('head')!==null;document.querySelectorAll('*').forEach(el=>{for(const {name} of [...el.attributes]){const n=name.toLowerCase();if(el.tagName==='SCRIPT'){if(n==='type')continue;el.removeAttribute(name);continue;}if(el===document.documentElement&&keepHtml.has(n))continue;if(keepMicro.has(n))continue;if(keepGlobal.has(n))continue;if(inHead(el)){if(el.tagName==='META'&&keepHeadMeta.has(n))continue;if(el.tagName==='LINK'&&keepLinkHead.has(n))continue;continue;}if(n==='id'||n==='class'||n==='style'||n.startsWith('on')||n.startsWith('data-')||n==='role'||n==='tabindex'||n.startsWith('aria-')){el.removeAttribute(name);}else if(!inHead(el)){if(!keepGlobal.has(n)&&!keepMicro.has(n))el.removeAttribute(name);}}});{const w=document.createTreeWalker(document,NodeFilter.SHOW_COMMENT);const cs=[];while(w.nextNode())cs.push(w.currentNode);cs.forEach(n=>n.remove());}$all('img').forEach(img=>{const ds=img.getAttribute('data-src')||img.getAttribute('data-original')||img.getAttribute('data-lazy-src');if(!img.getAttribute('src')&&ds)img.setAttribute('src',ds);img.removeAttribute('srcset');img.removeAttribute('sizes');});$all('picture').forEach(p=>{const c=p.querySelector('img,source');const i=document.createElement('img');const src=(c?.getAttribute('src')||c?.getAttribute('srcset')||'').split(' ')[0]||c?.getAttribute('data-src')||'';if(src)i.src=src;const alt=p.querySelector('img')?.getAttribute('alt');if(alt)i.setAttribute('alt',alt);p.replaceWith(i);});{const tw=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT);const ts=[];while(tw.nextNode())ts.push(tw.currentNode);ts.forEach(t=>{const s=t.nodeValue.replace(/\s+/g,' ').trim();if(s)t.nodeValue=s;else t.remove();});}$all('div,span,section,article,aside,header,footer,nav').forEach(el=>{const meaningful=el.textContent.trim().length>0||el.querySelector('img,picture,svg,video,meta,script[type="application/ld+json"]');if(!meaningful)el.remove();});document.documentElement.setAttribute('data-clean-view','1');let html='<!doctype html>'+document.documentElement.outerHTML;html=html.replace(/>\s+</g,'><').replace(/\s{2,}/g,' ');const blob=new Blob([html],{type:'text/html;charset=utf-8'});const a=document.createElement('a');const slug=(location.pathname.replace(/\/$/,'').split('/').pop()||'index').replace(/[^\w.-]+/g,'-');a.href=URL.createObjectURL(blob);a.download=`clean-${slug}.html`;document.body.appendChild(a);a.click();a.remove();})(); 
